<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PVC-FREE K2025 contatti e database — Database Materiali</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  :root { --bg:#0f172a; --card:#0b1220; --muted:#94a3b8; --accent:#22c55e; --ring:#38bdf8; --text:#e5e7eb; --border:#1f2937; }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 1200px at 20% -5%, #0ea5e910, transparent 60%),radial-gradient(1400px 1400px at 120% 10%, #22c55e10, transparent 50%),var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;min-height:100vh}
  header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#0f172a,#0f172acc);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid #111827}
  .nav{display:flex;align-items:center;gap:12px;padding:10px 14px;max-width:1200px;margin:0 auto}
  .brand h1{font-size:18px;line-height:1.1;margin:0;background:linear-gradient(90deg,#e5e7eb,#93c5fd,#6ee7b7);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800}
  .brand small{color:#9ca3af;font-weight:600}
  .tabs{display:flex;gap:8px;margin:10px 0}
  .tab{padding:8px 12px;border-radius:10px;border:1px solid #334155;cursor:pointer;color:#e5e7eb;text-decoration:none}
  .tab.active{background:#0b1220;border-color:#22c55e;color:#22c55e}
  .container{padding:16px;max-width:1200px;margin:0 auto}
  .card{background:linear-gradient(180deg,#0b1220,#0b1220f0);border:1px solid var(--border);border-radius:16px;box-shadow:0 20px 60px #0006}
  .card-pad{padding:16px}
  .muted{color:var(--muted)}
  label{font-size:12px;color:var(--muted);display:block;margin:6px 0}
  select,input{width:100%;background:#0a0f1d;color:var(--text);border:1px solid #1e293b;border-radius:10px;padding:10px 12px;outline:none;transition:all .2s ease}
  select:focus,input:focus{border-color:var(--ring);box-shadow:0 0 0 3px #38bdf833}
  .grid{display:grid;gap:10px;grid-template-columns:repeat(12,1fr)}
  .col-12{grid-column:span 12}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
  @media (max-width:900px){.col-6,.col-4,.col-3{grid-column:span 12}}
  .right{margin-left:auto}
  .table-wrap{margin-top:12px;overflow:auto}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid #1f2937;padding:10px 8px;text-align:left;vertical-align:top;font-size:14px}
  th{color:#cbd5e1;font-weight:700;position:sticky;top:0;background:#0b1220}
  tr:hover td{background:#0b1220bb}
  .badge{display:inline-flex;gap:6px;align-items:center;padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #334155;color:#a5b4fc}
  .controls{display:flex;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><h1>PVC-FREE K2025 contatti e database</h1><small>by TPV Compound</small></div>
    <div class="right"><img src="./assets/sft-polymer.png" alt="SFT Polymer" style="height:26px"/></div>
  </div>
  <div class="nav" style="padding-top:0">
    <div class="tabs">
      <a class="tab" href="./index.html">Contatti</a>
      <div class="tab active">Database Materiali</div>
    </div>
  </div>
</header>

<main class="container">
  <section class="card card-pad">
    <h2 style="margin-top:0">Database Materiali <span class="muted">— scegli tra i materiali a disposizione</span></h2>
    <div class="grid">
      <div class="col-3">
        <label>Polimero</label>
        <select id="f-polimero">
          <option value="">Tutti</option>
          <option value="TPE-S">TPE-S</option>
          <option value="BIO">BIO</option>
          <option value="TPU">TPU</option>
          <option value="TPO">TPO</option>
        </select>
      </div>
      <div class="col-3">
        <label>Applicazione</label>
        <select id="f-applicazione">
          <option value="">Tutte</option>
          <option value="tecnico">tecnico</option>
          <option value="biodegradabile">biodegradabile</option>
          <option value="medicale">medicale</option>
        </select>
      </div>
      <div class="col-3">
        <label>Durezza (Shore A) — da</label>
        <input id="f-hard-min" type="number" placeholder="min" min="0" max="100"/>
      </div>
      <div class="col-3">
        <label>…a</label>
        <input id="f-hard-max" type="number" placeholder="max" min="0" max="100"/>
      </div>
    </div>

    <div class="controls" style="margin-top:10px">
      <div class="muted">Sorgente: <code>./data/materiali_database.csv</code></div>
      <div class="right"></div>
    </div>

    <div class="table-wrap card card-pad" style="margin-top:12px">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Processo</th>
            <th>regulation</th>
            <th>Peso Specifico (g/cm3) ISO 1183-1</th>
            <th>Carico di Rottura (N/mm2) ISO 527</th>
            <th>Allungamento a Rottura (N/mm2) ISO 527</th>
            <th>Compression Set (ASTM D 395) (22°C/72h)</th>
            <th>special features</th>
          </tr>
        </thead>
        <tbody id="materials-body"></tbody>
      </table>
      <div id="materials-empty" class="muted" style="margin-top:8px;display:none">Nessun materiale corrispondente ai filtri.</div>
    </div>
  </section>
</main>

<script>
const CSV_PATH = "./data/materiali_database.csv";

let rows = [];
let cols = {
  polimero:null, applicazione:null, durezza:null,
  processo:null, regulation:null, peso:null, carico:null, allungamento:null, compress:null, special:null
};

function $(s){ return document.querySelector(s); }
function normalizeKey(s){
  return String(s||"").toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/\s+/g," ").trim();
}
function pick(header, candidates){
  const H = header.map(h => ({raw:h, key:normalizeKey(h)}));
  for (const cand of candidates){
    for (const h of H){
      if (h.key.includes(cand)) return h.raw;
    }
  }
  return null;
}

function mapColumns(header){
  cols.polimero     = pick(header, ["polimero","polymer","categoria materiale","categoria","famiglia","tipo"]);
  cols.applicazione = pick(header, ["applicazione","application","uso","use"]);
  cols.durezza      = pick(header, ["durezza","shore a","shorea","shore","hardness"]);
  cols.processo     = pick(header, ["processo","process"]);
  cols.regulation   = pick(header, ["regulation","regolazione","normativa","compliance"]);
  cols.peso         = pick(header, ["peso specifico","densita","density","g/cm3"]);
  cols.carico       = pick(header, ["carico di rottura","tensile strength","iso 527"]);
  cols.allungamento = pick(header, ["allungamento","elongazione","elongation"]);
  cols.compress     = pick(header, ["compression set","astm d 395","compress"]);
  cols.special      = pick(header, ["special features","features","caratteristiche","note speciali","note"]);
}

function toNumber(x){
  if (x === null || x === undefined) return NaN;
  let s = String(x).toLowerCase().replace(",", ".");
  const m = s.match(/(\d+(\.\d+)?)/);
  return m ? parseFloat(m[1]) : NaN;
}

function loadCSV(){
  Papa.parse(CSV_PATH, {
    download: true, header: true, skipEmptyLines: true, dynamicTyping: false,
    complete: function(res){
      const data = res.data || [];
      if (!data.length){ $("#materials-empty").style.display = "block"; return; }
      const header = res.meta.fields || Object.keys(data[0]);
      mapColumns(header);

      rows = data.map(r => ({
        polimero:     r[cols.polimero],
        applicazione: r[cols.applicazione],
        durezza:      r[cols.durezza],
        processo:     r[cols.processo],
        regulation:   r[cols.regulation],
        peso:         r[cols.peso],
        carico:       r[cols.carico],
        allungamento: r[cols.allungamento],
        compress:     r[cols.compress],
        special:      r[cols.special]
      }));

      const hardnessValues = rows.map(r => toNumber(r.durezza)).filter(v => !isNaN(v));
      const min = Math.min.apply(null, hardnessValues.length ? hardnessValues : [0]);
      const max = Math.max.apply(null, hardnessValues.length ? hardnessValues : [100]);
      const minEl = $("#f-hard-min"), maxEl = $("#f-hard-max");
      if (minEl) minEl.value = Math.max(0, Math.floor(min));
      if (maxEl) maxEl.value = Math.min(100, Math.ceil(max));

      $("#f-polimero").addEventListener("change", render);
      $("#f-applicazione").addEventListener("change", render);
      $("#f-hard-min").addEventListener("input", render);
      $("#f-hard-max").addEventListener("input", render);

      render();
    },
    error: function(err){ console.error(err); $("#materials-empty").style.display="block"; }
  });
}

function render(){
  const fp = ($("#f-polimero").value || "").toLowerCase();
  const fa = ($("#f-applicazione").value || "").toLowerCase();
  const hmin = parseFloat($("#f-hard-min").value || "0");
  const hmax = parseFloat($("#f-hard-max").value || "100");

  const filtered = rows.filter(r => {
    if (fp && String(r.polimero||"").toLowerCase() !== fp) return false;
    if (fa && String(r.applicazione||"").toLowerCase() !== fa) return false;
    const hv = toNumber(r.durezza);
    if (!isNaN(hmin) && hv < hmin) return false;
    if (!isNaN(hmax) && hv > hmax) return false;
    return true;
  });

  const body = $("#materials-body"); body.innerHTML = "";
  filtered.forEach((r, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td>
      <td>${r.processo ?? ""}</td>
      <td>${r.regulation ?? ""}</td>
      <td>${r.peso ?? ""}</td>
      <td>${r.carico ?? ""}</td>
      <td>${r.allungamento ?? ""}</td>
      <td>${r.compress ?? ""}</td>
      <td>${r.special ?? ""}</td>`;
    body.appendChild(tr);
  });
  $("#materials-empty").style.display = filtered.length ? "none" : "block";
}

document.addEventListener("DOMContentLoaded", loadCSV);
</script>
</body>
</html>
